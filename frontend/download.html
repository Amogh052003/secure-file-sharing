<!DOCTYPE html>
<html>
<head>
  <title>Downloading...</title>
  <script>
    async function downloadFile() {
      const params = new URLSearchParams(window.location.search);
      const fileName = params.get('file');
      if (!fileName) {
        document.body.innerText = "❌ Missing file name in URL.";
        return;
      }

      try {
        const response = await fetch(
          `https://filesharingfuncapp-h6c6f8hbe9egbucc.centralindia-01.azurewebsites.net/api/generate_sas_download?filename=${encodeURIComponent(fileName)}`
        );

        if (!response.ok) {
          throw new Error("Failed to get download URL");
        }

        const data = await response.json();
        const downloadUrl = data.url;

        const link = document.createElement("a");
        link.href = downloadUrl;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        document.body.innerHTML = `✅ Your file <strong>${fileName}</strong> is downloading...`;
      } catch (err) {
        document.body.innerHTML = `❌ Error downloading file: ${err.message}`;
      }
    }

    window.onload = downloadFile;
  </script>
</head>
<body>
  <p>Preparing your download...</p>
</body>
</html>
